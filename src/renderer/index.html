<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' 'unsafe-inline' 'unsafe-eval' file: data: blob:;" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CompIDE — Competitive Programming IDE</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="theme-dark">

  <!-- ── Title Bar ──────────────────────────────────────────── -->
  <div id="titlebar">
    <div id="titlebar-drag"></div>
    <div id="titlebar-info">
      <span id="lang-badge" class="badge">Java</span>
      <span id="file-name">untitled.java</span>
    </div>
    <div id="titlebar-actions">
      <button id="btn-run" class="btn-primary" title="Run (⌘↵)">▶ Run</button>
      <button id="btn-run-input" class="btn-secondary" title="Run with custom input (⌘⇧↵)">Input</button>
      <button id="btn-run-tests" class="btn-secondary" title="Run all tests (⌘T)">Tests</button>
      <button id="btn-stop" class="btn-danger" title="Stop (⌘.)">■ Stop</button>
      <button id="btn-toggle-sidebar" class="btn-secondary" title="Toggle sidebar (⌘B)">Hide</button>
      <button id="btn-settings" class="btn-icon" title="Settings (⌘,)">⚙</button>
    </div>
  </div>

  <!-- ── Main Layout ────────────────────────────────────────── -->
  <div id="main-layout">

    <!-- Sidebar -->
    <aside id="sidebar">
      <div class="sidebar-brand">
        <img id="sidebar-logo" src="../../assets/icons/logo.png" alt="CompIDE Logo" />
        <div class="sidebar-brand-meta">
          <div class="sidebar-brand-name">CompIDE</div>
          <div class="sidebar-brand-credit">Created by atrak.dev</div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">LANGUAGE</div>
        <select id="lang-select">
          <option value="java">Java</option>
          <option value="cpp">C++</option>
          <option value="python">Python</option>
        </select>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">TEMPLATES</div>
        <div id="template-list">
          <button class="template-btn" data-template="java-usaco">USACO Java</button>
          <button class="template-btn" data-template="cpp-usaco">USACO C++</button>
          <button class="template-btn" data-template="python-usaco">USACO Python</button>
          <button class="template-btn" data-template="java-dp">DP Template</button>
          <button class="template-btn" data-template="python-dp">Python DP</button>
          <button class="template-btn" data-template="cpp-graph">Graph Template</button>
          <button class="template-btn" data-template="python-graph">Python Graph</button>
          <button class="template-btn" data-template="java-scanner">Fast Scanner</button>
          <button class="template-btn" data-template="python-fastio">Python Fast I/O</button>
          <button class="template-btn" data-template="cpp-segment">Segment Tree</button>
          <button class="template-btn" data-template="java-binary-search">Java Binary Search</button>
          <button class="template-btn" data-template="cpp-binary-search">C++ Binary Search</button>
          <button class="template-btn" data-template="java-dsu">Java DSU</button>
          <button class="template-btn" data-template="cpp-dsu">C++ DSU</button>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">RECENT FILES</div>
        <div id="recent-files-list"></div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">PROJECT</div>
        <div class="sidebar-inline-actions">
          <button class="tool-btn sidebar-mini-btn" id="btn-open-project-folder" title="Choose project folder">Open</button>
          <button class="tool-btn sidebar-mini-btn" id="btn-refresh-project" title="Refresh project tree">Sync</button>
        </div>
        <div id="project-root-label">No project folder selected.</div>
        <div id="project-tree"></div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">BUNDLE STATUS</div>
        <div class="sidebar-inline-actions">
          <button class="tool-btn sidebar-mini-btn" id="btn-refresh-bundles" title="Refresh runtime detection">Scan</button>
        </div>
        <div id="bundle-status">
          <div class="bundle-item" id="bundle-java">
            Java: <span>checking…</span>
            <div class="bundle-meta"></div>
          </div>
          <div class="bundle-item" id="bundle-cpp">
            C++: <span>checking…</span>
            <div class="bundle-meta"></div>
          </div>
          <div class="bundle-item" id="bundle-python">
            Python: <span>checking…</span>
            <div class="bundle-meta"></div>
          </div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">WORKSPACE</div>
        <div class="sidebar-inline-actions">
          <button class="tool-btn sidebar-mini-btn" id="btn-refresh-repo" title="Refresh git status">Sync</button>
          <button class="tool-btn sidebar-mini-btn" id="btn-open-terminal" title="Open terminal in workspace">Terminal</button>
          <button class="tool-btn sidebar-mini-btn" id="btn-open-remote" title="Open remote URL">Remote</button>
        </div>
        <div id="repo-status">
          <div id="repo-branch">No git repo</div>
          <div id="repo-dirty"></div>
          <div id="repo-root"></div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">VSCODE IMPORT</div>
        <div id="vscode-import-summary">
          <span id="vscode-import-count">0 snippets</span>
          <div class="sidebar-inline-actions compact">
            <button class="tool-btn sidebar-mini-btn" id="btn-import-vscode-ext" title="Import unpacked VSCode extension folder">+ Folder</button>
            <button class="tool-btn sidebar-mini-btn" id="btn-import-vscode-vsix" title="Import .vsix extension package">+ VSIX</button>
          </div>
        </div>
        <div id="vscode-imports-list"></div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">SUBMISSION</div>
        <div id="submit-panel">
          <label class="submit-label">Platform
            <select id="submit-platform">
              <option value="codeforces">Codeforces</option>
              <option value="usaco">USACO</option>
            </select>
          </label>

          <div id="submit-codeforces-fields">
            <label class="submit-label">Contest
              <input type="text" id="submit-cf-contest" placeholder="e.g. 2000" />
            </label>
            <label class="submit-label">Problem
              <input type="text" id="submit-cf-problem" placeholder="e.g. A" />
            </label>
          </div>

          <div id="submit-usaco-fields" class="submit-hidden">
            <label class="submit-label">USACO CPID (optional)
              <input type="text" id="submit-usaco-cpid" placeholder="e.g. 1234" />
            </label>
          </div>

          <div class="submit-actions">
            <button class="tool-btn" id="btn-submit-open-problem">Problem</button>
            <button class="tool-btn" id="btn-submit-open-submit">Submit</button>
            <button class="tool-btn" id="btn-submit-export">Export</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Center Content -->
    <div id="center-content">

      <!-- Editor + IO split -->
      <div id="editor-io-split">

        <!-- Editor pane -->
        <div id="editor-pane">
          <div id="editor-toolbar">
            <span class="toolbar-label">Editor</span>
            <div class="toolbar-actions">
              <button class="tool-btn" id="btn-open" title="Open file">Open</button>
              <button class="tool-btn" id="btn-save" title="Save file">Save</button>
              <button class="tool-btn" id="btn-format" title="Format code">Format</button>
            </div>
          </div>
          
          <!-- Welcome Screen (overlay) -->
          <div id="welcome-screen" class="hidden">
            <div class="welcome-hero">
              <img id="welcome-logo" src="../../assets/icons/logo.png" alt="CompIDE Logo" />
              <h1>CompIDE</h1>
              <p>Competitive Programming Made Fast</p>
              <p class="welcome-credit">Created by atrak.dev</p>
            </div>
            <div class="welcome-actions">
              <button id="btn-welcome-new" class="welcome-btn">New File (⌘N)</button>
              <button id="btn-welcome-open" class="welcome-btn">Open File (⌘O)</button>
            </div>
            <div class="welcome-keys">
              <div class="key-row"><span class="key">⌘</span> + <span class="key">Enter</span> <span>Run Code</span></div>
              <div class="key-row"><span class="key">⌘</span> + <span class="key">T</span> <span>Run Tests</span></div>
            </div>
          </div>

          <div id="monaco-editor"></div>
        </div>

        <!-- Resize handle -->
        <div id="resize-handle-v" class="resize-handle resize-v"></div>

        <!-- IO pane -->
        <div id="io-pane">
          <!-- Tabs -->
          <div id="io-tabs">
            <button class="io-tab active" data-tab="output">Output</button>
            <button class="io-tab" data-tab="input">Input</button>
            <button class="io-tab" data-tab="tests">Test Cases</button>
          </div>

          <!-- Output tab -->
          <div id="tab-output" class="io-tab-content active">
            <div id="output-toolbar">
              <span id="run-status" class="status-idle">Ready</span>
              <span id="run-time"></span>
              <button class="tool-btn" id="btn-clear-output" title="Clear output">Clear</button>
              <button class="tool-btn" id="btn-copy-output" title="Copy output">Copy</button>
            </div>
            <pre id="output-area"></pre>
          </div>

          <!-- Input tab -->
          <div id="tab-input" class="io-tab-content">
            <div id="input-toolbar">
              <span class="toolbar-label">Custom Input (auto-saved)</span>
              <button class="tool-btn" id="btn-clear-input" title="Clear input">Clear</button>
            </div>
            <textarea id="input-area" placeholder="Type or paste input here…" spellcheck="false"></textarea>
          </div>

          <!-- Tests tab -->
          <div id="tab-tests" class="io-tab-content">
            <div id="tests-toolbar">
              <span class="toolbar-label">Test Cases</span>
              <button class="tool-btn" id="btn-add-test" title="Add empty test">+ Add</button>
              <button class="tool-btn" id="btn-import-test-files" title="Import input/output files as tests">Files</button>
              <button class="tool-btn" id="btn-paste-test" title="Paste sample from clipboard (auto-detects Input/Output)">Paste</button>
              <button class="tool-btn" id="btn-fetch-problem" title="Fetch sample tests from problem URL">Fetch</button>
              <button class="tool-btn btn-primary-sm" id="btn-run-all-tests">▶ Run All</button>
            </div>
            <div id="tests-fetch-row">
              <input id="problem-url-input" type="text" placeholder="Paste Codeforces/USACO problem URL to auto-load sample tests" />
            </div>
            <div id="test-cases-container"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ── Status Bar ─────────────────────────────────────────── -->
  <div id="status-bar">
    <div class="status-left">
      <span id="sb-git-branch" class="status-item" title="Git Branch"><span class="icon">git</span> <span id="sb-git-text">-</span></span>
    </div>
    <div class="status-right">
      <span id="sb-cursor" class="status-item">Ln 1, Col 1</span>
      <span id="sb-indent" class="status-item">Spaces: 4</span>
      <span id="sb-encoding" class="status-item">UTF-8</span>
      <span id="sb-lang" class="status-item">Java</span>
    </div>
  </div>

  <!-- ── Setup Modal ───────────────────────────────────────── -->
  <div id="setup-overlay" class="modal-overlay hidden">
    <div class="setup-modal">
      <div class="setup-header">
        <h1>Welcome to CompIDE</h1>
        <p>Let's get your environment set up for competitive programming.</p>
      </div>
      <div class="setup-body">
        <div class="setup-step">
          <h3>Choose your theme</h3>
          <div class="theme-options">
            <div class="theme-card selected" data-theme="dark" onclick="selectSetupTheme('dark')">
              <div class="theme-preview" style="background: #0d1117"></div>
              <span>Dark Modern</span>
            </div>
            <div class="theme-card" data-theme="light" onclick="selectSetupTheme('light')">
              <div class="theme-preview" style="background: #ffffff; border: 1px solid #e1e4e8;"></div>
              <span>Light Crisp</span>
            </div>
          </div>
        </div>
        <div class="setup-step">
          <h3>Preferred Language</h3>
          <select id="setup-lang-select" onchange="updateSetupLang()">
            <option value="java">Java (JDK 17+)</option>
            <option value="cpp">C++ (G++/Clang)</option>
            <option value="python">Python 3</option>
          </select>
          <div id="setup-lang-status" style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
            Checking...
          </div>
        </div>
      </div>
      <div class="setup-footer">
        <button class="setup-btn-next" onclick="finishSetup()">Get Started →</button>
      </div>
    </div>
  </div>

  <!-- ── Settings Modal ────────────────────────────────────── -->
  <div id="settings-overlay" class="modal-overlay hidden">
    <div id="settings-modal" class="modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close" id="btn-settings-close">✕</button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>Appearance</h3>
          <label>Theme
            <select id="setting-theme">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
              <option value="hc-black">High Contrast</option>
            </select>
          </label>
          <label>Font Size
            <input type="number" id="setting-font-size" min="10" max="28" />
          </label>
        </div>
        <div class="settings-section">
          <h3>Editor</h3>
          <label>Tab Size
            <input type="number" id="setting-tab-size" min="2" max="8" />
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-line-numbers" /> Show Line Numbers
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-word-wrap" /> Word Wrap
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-minimap" /> Minimap
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-format-on-save" /> Format on Save
          </label>
        </div>
        <div class="settings-section">
          <h3>Execution</h3>
          <label>Time Limit (ms)
            <input type="number" id="setting-time-limit" min="100" max="30000" step="100" />
          </label>
          <label>Memory Limit (MB)
            <input type="number" id="setting-memory-limit" min="32" max="1024" step="32" />
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-usaco-mode" /> Enable USACO file mode
          </label>
          <label>USACO Problem Base Name
            <input type="text" id="setting-usaco-problem" placeholder="problem" />
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-usaco-file-input" /> Use &lt;problem&gt;.in when custom input is empty
          </label>
        </div>
        <div class="settings-section">
          <h3>Language Paths</h3>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-auto-pick-bundle" /> Auto pick best installed bundle
          </label>
          <label>Java Binary (leave blank for auto)
            <input type="text" id="setting-java-path" placeholder="e.g. /usr/bin/java" />
          </label>
          <label>Javac Binary (leave blank for auto)
            <input type="text" id="setting-javac-path" placeholder="e.g. /usr/bin/javac" />
          </label>
          <label>C++ Compiler
            <input type="text" id="setting-cpp-compiler" placeholder="g++ / clang++ / cl" />
          </label>
          <label>Python Binary
            <input type="text" id="setting-python-path" placeholder="python3 or py -3" />
          </label>
          <label>Java Formatter Path
            <input type="text" id="setting-java-formatter-path" placeholder="google-java-format or /path/tool.jar" />
          </label>
          <label>C++ Formatter Path
            <input type="text" id="setting-clang-format-path" placeholder="clang-format" />
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button id="btn-settings-save" class="btn-primary">Save Settings</button>
        <button id="btn-settings-cancel" class="modal-close-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Monaco loader -->
  <script>
    // Set Monaco base path so it can load its workers from node_modules
    window.monacoBasePath = '../../node_modules/monaco-editor/min/vs';
  </script>
  <script src="../../node_modules/monaco-editor/min/vs/loader.js"></script>
  <script>
    if (window.require && window.require.config) {
      window.require.config({ paths: { vs: window.monacoBasePath } });
    }
  </script>
  <script src="app.js"></script>
</body>
</html>
